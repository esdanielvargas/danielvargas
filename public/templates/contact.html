<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <link rel="shortcut icon" href="../favicon.ico" type="image/x-icon">
  <title>Preview: Contact</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <link rel="stylesheet"
    href="https://fonts.googleapis.com/css2?family=Google+Sans+Code:ital,wght@0,300..800;1,300..800&family=Google+Sans+Flex:opsz,wght@6..144,1..1000&family=Google+Sans:ital,opsz,wght@0,17..18,400..700;1,17..18,400..700&family=Space+Grotesk:wght@300..700&display=swap">
  <style>
    body,
    html {
      margin: 0;
      padding: 0;
      height: 100%;
      background-color: #f5f5f5;
      scrollbar-color: #cdcdcd #0a0a0a;
    }
  </style>
</head>

<body>

  <div class="no-print bg-neutral-100 border-b border-neutral-300 p-4 text-neutral-50">
    <div class="max-w-[600px] mx-auto flex flex-wrap items-center justify-between gap-4">
      <div class="flex items-center gap-4">
        <a href="./index.html" style="font-family: 'Space Grotesk', sans-serif;"
          class="min-h-9 flex items-center justify-center text-xs bg-neutral-950 px-4 py-2 rounded-lg font-medium hover:-rotate-2 active:scale-105 transition-all duration-300 ease-out">
          Volver atrás</a>  
        <h1 style="font-family: 'Google Sans Flex', sans-serif;" class="font-bold text-base uppercase text-neutral-950">Contact</h1>
      </div>
      <div class="flex items-center gap-1">
        <button onclick="toggleForm()" style="font-family: 'Space Grotesk', sans-serif;"
          class="min-h-9 flex items-center justify-center text-xs bg-neutral-950 px-4 py-2 rounded-lg font-medium hover:-rotate-2 active:scale-105 transition-all duration-300 ease-out">
          Mostrar / Ocultar
        </button>
        <button onclick="downloadPNG()" style="font-family: 'Space Grotesk', sans-serif;"
          class="min-w-9 min-h-9 text-xs bg-neutral-950 flex items-center justify-center rounded-lg font-medium hover:-rotate-2 active:scale-105 transition-all duration-300 ease-out">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
            class="lucide lucide-download-icon lucide-download">
            <path d="M12 15V3" />
            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
            <path d="m7 10 5 5 5-5" />
          </svg>
        </button>
      </div>
    </div>

    <div id="editor-form" class="max-w-4xl mx-auto mt-6 hidden">
      <form id="param-form"
        class="max-w-[600px] mx-auto grid grid-cols-1 md:grid-cols-2 gap-2.5 bg-white text-black p-6 rounded-xl border border-neutral-200"
        style="font-family: 'Google Sans Flex', sans-serif;">
        <div>
          <label class="block text-[10px] uppercase text-neutral-500 mb-1">Nombre completo</label>
          <input name="name" type="text" placeholder="Ingrese su nombre completo"
            class="w-full bg-neutral-100 border border-neutral-200 rounded p-2 text-xs focus:outline-none focus:border-sky-500 transition-all duration-300 ease-out">
        </div>
        <div>
          <label class="block text-[10px] uppercase text-neutral-500 mb-1">Correo electrónico</label>
          <input name="email" type="email" placeholder="Ingrese su correo electrónico"
            class="w-full bg-neutral-100 border border-neutral-200 rounded p-2 text-xs focus:outline-none focus:border-sky-500 transition-all duration-300 ease-out">
        </div>
        <div class="md:col-span-2">
          <label class="block text-[10px] uppercase text-neutral-500 mb-1">Mensaje</label>
          <textarea name="message" placeholder="Cuénteme sobre su proyecto..." rows="3"
            class="w-full bg-neutral-100 border border-neutral-200 rounded p-2 text-xs focus:outline-none focus:border-sky-500 transition-all duration-300 ease-out"></textarea>
        </div>
        <button type="submit" style="font-family: 'Space Grotesk', sans-serif;"
          class="min-h-9 md:col-span-2 bg-neutral-950 text-neutral-50 font-bold py-2 rounded hover:bg-neutral-800 transition-all duration-300 ease-out text-sm">
          Actualizar vista previa
        </button>
      </form>
    </div>
  </div>

  <div id="email-content"
    style="min-height: 100%; background-color: #f5f5f5; padding: 30px 10px; font-family: 'Google Sans Flex', system-ui, sans-serif;">

    <div
      style="max-width: 600px; margin: 0 auto; background-color: #ffffff; padding: 15px; border-radius: 12px; border: 1px solid #e0e0e0; box-shadow: 0 2px 4px rgba(0,0,0,0.05);">

      <div style="font-size: 12px; color: #3c4043; margin-bottom: 15px;">
        Has recibido un mensaje de <strong class="var-name">{{name}}</strong>. Por favor, responde lo antes posible.
      </div>

      <div style="padding: 15px 0; border-top: 1px solid #eeeeee; border-bottom: 1px solid #eeeeee;">
        <table role="presentation" border="0" cellpadding="0" cellspacing="0" width="100%">
          <tr>
            <td style="vertical-align: top;">
              <div style="margin-bottom: 2px;">
                <strong class="var-name" style="font-size: 14px; color: #202124;">{{name}}</strong>
                <span class="var-email" style="font-size: 12px; color: #5e5e5e;">&lt;{{email}}&gt;</span>
              </div>
              <div class="var-time" style="font-size: 11.5px; color: #70757a; margin-bottom: 15px;">
                {{time}}
              </div>

              <div style="padding: 12px; border-radius: 10px; border: 1px dashed #dadce0; background-color: #fafafa;">
                <div class="var-message" style="font-size: 13px; line-height: 1.5; color: #3c4043;">
                  {{message}}
                </div>
              </div>
            </td>
          </tr>
        </table>
      </div>

      <div style="margin-top: 15px; font-size: 11px; color: #9aa0a6; text-align: left;">
        Este correo electrónico fue enviado por <strong class="var-email"
          style="color: #9aa0a6 !important;">{{email}}</strong> desde la página de contacto de tu portafolio.
      </div>

    </div>
  </div>

  <script>
    // Función para obtener parámetros de la URL
    const params = new URLSearchParams(window.location.search);
    const form = document.getElementById('editor-form');

    // Si NO hay parámetros en la URL, mostramos el formulario por defecto
    if (!params.has('name')) {
      form.classList.remove('hidden');
    }

    function toggleForm() {
      form.classList.toggle('hidden');
    }

    function downloadPNG() {
      const target = document.getElementById('email-content');

      // Usamos html2canvas para "dibujar" el div en un canvas
      html2canvas(target, {
        backgroundColor: "#f5f5f5", // Asegura que el fondo se mantenga
        scale: 2, // Aumenta la resolución para que no se vea pixeleado
        useCORS: true, // Por si tienes imágenes externas
        logging: false
      }).then(canvas => {
        // Convertimos el canvas a una URL de imagen
        const image = canvas.toDataURL("image/png");

        // Creamos un enlace temporal para forzar la descarga
        const link = document.createElement('a');
        link.download = `email-preview-${params.get('name').toLowerCase().replace(/ /, "-") || 'template'}.png`;
        link.href = image;
        link.click();
      });
    }

    // Obtenemos el mensaje y reemplazamos los saltos de línea (\n) por etiquetas <br>
    const rawMessage = params.get('message') || 'Este es un mensaje de prueba para ver el diseño del correo. ✨';
    const formattedMessage = rawMessage.replace(/\n/g, '<br>');

    // Objeto con los valores (usa valores por defecto si no existen en la URL)
    const values = {
      name: params.get('name') || 'Nombre de Prueba',
      email: params.get('email') || 'ejemplo@correo.com',
      time: params.get('time') || new Date().toLocaleString("es", { weekday: "long", day: "2-digit", month: "long", year: "numeric", hour: "2-digit", minute: "2-digit" }),
      message: formattedMessage
    };

    // Reemplazo dinámico en el HTML
    let content = document.getElementById('email-content').innerHTML;

    Object.keys(values).forEach(key => {
      const regex = new RegExp(`{{${key}}}`, 'g');
      content = content.replace(regex, values[key]);
    });

    document.getElementById('email-content').innerHTML = content;

    // Manejar el envío del formulario
    document.getElementById('param-form').addEventListener('submit', (e) => {
      e.preventDefault();
      const formData = new FormData(e.target);
      const newParams = new URLSearchParams();

      formData.forEach((value, key) => {
        if (value) newParams.append(key, value);
      });

      // Redirigir a la misma página con los nuevos parámetros
      window.location.search = newParams.toString();
    });
  </script>

</body>

</html>